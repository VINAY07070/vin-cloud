
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VinGPT Ultimate</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <style>
        /* Base Aesthetic */
        body { background-color: #f3f4f6; color: #111827; font-family: 'Inter', sans-serif; }
        
        /* Chat Bubbles */
        .msg-user { background: #000; color: white; border-radius: 18px 18px 4px 18px; }
        .msg-ai { background: #fff; color: #374151; border-radius: 18px 18px 18px 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        
        /* Image Output */
        .ai-image { border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); transition: transform 0.3s; cursor: pointer; }
        .ai-image:hover { transform: scale(1.02); }

        /* Code Blocks */
        pre { background: #1e1e1e !important; padding: 15px; border-radius: 10px; overflow-x: auto; font-size: 0.9em; }
        
        /* Loading Animation */
        .typing-dot { width: 6px; height: 6px; background: #9ca3af; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
    </style>
</head>
<body class="h-screen flex flex-col md:flex-row overflow-hidden">

    <div id="sidebar" class="w-72 bg-white border-r border-gray-200 hidden md:flex flex-col z-20">
        <div class="p-6">
            <h1 class="text-2xl font-bold tracking-tight">VinGPT <span class="text-indigo-600 text-xs align-top">ULTIMATE</span></h1>
        </div>
        
        <div class="flex-1 px-4 space-y-6 overflow-y-auto">
            <div>
                <label class="text-xs font-bold text-gray-400 uppercase">Intelligence Model</label>
                <select id="modelSelect" class="w-full mt-2 p-3 bg-gray-50 border border-gray-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-indigo-500">
                    <option value="llama-3.3-70b-versatile">Llama 3.3 (Genius)</option>
                    <option value="mixtral-8x7b-32768">Mixtral (Creative)</option>
                    <option value="gemma2-9b-it">Gemma 2 (Fast)</option>
                </select>
            </div>

            <div class="bg-indigo-50 p-4 rounded-xl space-y-2">
                <div class="text-xs font-bold text-indigo-800 uppercase">Capabilities Active</div>
                <div class="flex items-center gap-2 text-sm text-indigo-700">
                    <span>üåê</span> Live Web Search
                </div>
                <div class="flex items-center gap-2 text-sm text-indigo-700">
                    <span>üé®</span> Image Generation
                </div>
                <div class="flex items-center gap-2 text-sm text-indigo-700">
                    <span>üó£Ô∏è</span> Neural Voice
                </div>
            </div>
        </div>

        <div class="p-4 border-t border-gray-200">
            <button onclick="clearChat()" class="text-sm text-red-500 hover:text-red-700 font-medium w-full text-left p-2 hover:bg-red-50 rounded-lg transition">üóëÔ∏è Clear Memory</button>
            <a href="/logout" class="block text-sm text-gray-500 hover:text-black font-medium w-full text-left p-2 hover:bg-gray-100 rounded-lg transition mt-1">üö™ Log Out</a>
        </div>
    </div>

    <div class="flex-1 flex flex-col relative bg-[#f9fafb]">
        <div class="md:hidden h-14 bg-white border-b border-gray-200 flex items-center justify-between px-4 z-10">
            <span class="font-bold">VinGPT</span>
            <button onclick="toggleSidebar()" class="text-gray-600">‚ò∞</button>
        </div>

        <div id="chatContainer" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-6 pb-32">
            <div id="emptyState" class="h-full flex flex-col items-center justify-center opacity-40">
                <div class="w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center text-4xl mb-4">‚ú®</div>
                <h2 class="text-xl font-bold text-gray-800">Ready to create.</h2>
                <p class="text-sm text-gray-500 mt-2">Try "Draw a futuristic city" or "Price of Bitcoin"</p>
            </div>
        </div>

        <div class="absolute bottom-0 w-full bg-gradient-to-t from-[#f9fafb] via-[#f9fafb] to-transparent pt-10 pb-6 px-4">
            <div class="max-w-3xl mx-auto bg-white shadow-xl border border-gray-200 rounded-2xl flex items-end p-2 transition-shadow focus-within:ring-2 focus-within:ring-indigo-100">
                <textarea id="userInput" rows="1" class="w-full bg-transparent border-none outline-none p-3 text-gray-800 placeholder-gray-400 resize-none max-h-40" placeholder="Message VinGPT..."></textarea>
                <button onclick="send()" id="sendBtn" class="p-3 bg-black text-white rounded-xl hover:bg-gray-800 transition shadow-lg mb-0.5 mr-0.5">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7"></path></svg>
                </button>
            </div>
            <p class="text-center text-xs text-gray-400 mt-3">Powered by Vinay Intelligence ‚Ä¢ v5.0 Ultimate</p>
        </div>
    </div>

    <script>
        let history = [];
        const chatBox = document.getElementById('chatContainer');
        
        // --- VOICE 2.0 (HUMAN TUNING) ---
        function speak(text) {
            window.speechSynthesis.cancel();
            const utter = new SpeechSynthesisUtterance(text);
            const voices = window.speechSynthesis.getVoices();
            
            // Priority list for premium voices
            const preferred = voices.find(v => 
                v.name.includes("Google US English") || 
                v.name.includes("Microsoft Zira") || 
                v.name.includes("Samantha")
            );
            
            if (preferred) utter.voice = preferred;
            utter.rate = 1.05; // Slightly faster for natural flow
            utter.pitch = 1.0;
            window.speechSynthesis.speak(utter);
        }

        // --- CORE LOGIC ---
        async function send() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text) return;

            document.getElementById('emptyState').style.display = 'none';
            input.value = '';
            input.style.height = 'auto';

            // User UI
            addMsg('user', text);
            history.push({ role: "user", content: text });

            // Loading UI
            const loadId = addLoading();

            try {
                const res = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        message: text,
                        history: history,
                        model: document.getElementById('modelSelect').value
                    })
                });
                
                const data = await res.json();
                document.getElementById(loadId).remove();

                if (data.type === 'error') {
                    addMsg('system', "Error: " + data.content);
                } 
                else if (data.type === 'image') {
                    addImage(data.content, data.alt);
                    history.push({ role: "assistant", content: `[Generated Image: ${data.alt}]` });
                } 
                else {
                    addMsg('ai', data.content);
                    history.push({ role: "assistant", content: data.content });
                }

            } catch (e) {
                document.getElementById(loadId).remove();
                addMsg('system', "Network Error. Please try again.");
            }
        }

        // --- UI BUILDERS ---
        function addMsg(role, content) {
            const div = document.createElement('div');
            const isUser = role === 'user';
            
            div.className = `flex ${isUser ? 'justify-end' : 'justify-start'} animate-fade`;
            div.innerHTML = `
                <div class="max-w-[85%] md:max-w-[75%] p-4 text-sm leading-relaxed ${isUser ? 'msg-user' : 'msg-ai'}">
                    ${isUser ? content : marked.parse(content)}
                    ${!isUser ? `<button onclick="speak(this.parentElement.innerText)" class="mt-2 text-xs text-gray-400 hover:text-indigo-600 block transition">üîä Read</button>` : ''}
                </div>
            `;
            chatBox.appendChild(div);
            hljs.highlightAll();
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function addImage(url, alt) {
            const div = document.createElement('div');
            div.className = "flex justify-start animate-fade";
            div.innerHTML = `
                <div class="bg-white p-2 rounded-2xl shadow-sm border border-gray-100 max-w-md">
                    <img src="${url}" alt="${alt}" class="ai-image w-full h-auto" onload="this.scrollIntoView({behavior:'smooth'})">
                    <div class="p-2 text-xs text-gray-500 flex justify-between">
                        <span>üé® AI Generated</span>
                        <a href="${url}" target="_blank" class="text-indigo-600 hover:underline">Download</a>
                    </div>
                </div>
            `;
            chatBox.appendChild(div);
        }

        function addLoading() {
            const id = 'load-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = "flex justify-start";
            div.innerHTML = `
                <div class="msg-ai p-4 flex gap-1 items-center h-10">
                    <div class="typing-dot" style="animation-delay: 0s"></div>
                    <div class="typing-dot" style="animation-delay: 0.2s"></div>
                    <div class="typing-dot" style="animation-delay: 0.4s"></div>
                </div>
            `;
            chatBox.appendChild(div);
            return id;
        }

        function clearChat() {
            history = [];
            chatBox.innerHTML = '';
            document.getElementById('emptyState').style.display = 'flex';
        }

        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            sb.classList.toggle('hidden');
            sb.classList.toggle('absolute');
            sb.classList.toggle('h-full');
            sb.classList.toggle('shadow-2xl');
        }

        // Utils
        const txt = document.getElementById('userInput');
        txt.addEventListener('keydown', e => {
            if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); }
        });
        txt.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
    </script>
</body>
</html>